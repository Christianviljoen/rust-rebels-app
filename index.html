<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Rust Rebels | Quotes & Hours</title>
  <meta name="theme-color" content="#111111" />
  <style>
    :root{
      --bg:#0b0b0c; --card:#141416; --muted:#9aa0a6; --text:#f2f3f4;
      --accent:#f5b301; --danger:#ff5a5f; --ok:#4ade80; --line:#24262a;
      --shadow: 0 10px 25px rgba(0,0,0,.35);
      --radius: 16px;
      --font: -apple-system, system-ui, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
    }
    @media (prefers-color-scheme: light){
      :root{ --bg:#f6f7f8; --card:#ffffff; --muted:#5f6368; --text:#111; --line:#e8eaed; --shadow: 0 10px 25px rgba(0,0,0,.08); }
    }
    *{ box-sizing:border-box; }
    body{ margin:0; background:var(--bg); color:var(--text); font-family:var(--font); }
    header{
      position:sticky; top:0; z-index:20;
      background: linear-gradient(to bottom, rgba(0,0,0,.55), rgba(0,0,0,0));
      backdrop-filter: blur(10px);
      padding:14px 16px 10px;
    }
    .brand{ display:flex; align-items:center; gap:10px; }
    .logo{
      width:34px; height:34px; border-radius:10px;
      background: radial-gradient(circle at 30% 30%, var(--accent), #ff6a00);
      box-shadow: var(--shadow);
    }
    h1{ font-size:16px; margin:0; letter-spacing:.2px; }
    .sub{ font-size:12px; color:var(--muted); margin-top:2px; }

    main{ padding: 6px 16px 90px; max-width: 980px; margin: 0 auto; }
    .row{ display:flex; gap:12px; flex-wrap:wrap; }
    .card{
      background:var(--card); border:1px solid var(--line);
      border-radius:var(--radius); box-shadow:var(--shadow);
      padding:14px;
    }
    .card h2{ margin:0 0 10px; font-size:14px; }
    .grow{ flex: 1 1 340px; }
    .side{ flex: 1 1 260px; }

    label{ display:block; font-size:12px; color:var(--muted); margin: 10px 0 6px; }
    input, textarea, select{
      width:100%; padding:12px 12px; border-radius:12px;
      border:1px solid var(--line); background:transparent; color:var(--text);
      outline:none;
    }
    textarea{ min-height:84px; resize:vertical; }
    .btn{
      border:none; border-radius:12px; padding:12px 12px; font-weight:600;
      background: var(--line); color:var(--text);
      cursor:pointer;
    }
    .btn.primary{ background: var(--accent); color:#111; }
    .btn.danger{ background: var(--danger); color:white; }
    .btn.ghost{ background: transparent; border:1px solid var(--line); }
    .btn:active{ transform: translateY(1px); }

    .toolbar{ display:flex; gap:10px; flex-wrap:wrap; }
    .pill{
      display:inline-flex; gap:8px; align-items:center;
      padding:8px 10px; border:1px solid var(--line); border-radius:999px;
      color:var(--muted); font-size:12px;
    }
    .jobs{ display:flex; flex-direction:column; gap:10px; }
    .jobItem{
      display:flex; gap:10px; align-items:flex-start; justify-content:space-between;
      padding:12px; border:1px solid var(--line); border-radius:14px;
      background: rgba(255,255,255,0.02);
      cursor:pointer;
    }
    .jobTitle{ font-weight:700; font-size:14px; margin:0; }
    .jobMeta{ margin:4px 0 0; font-size:12px; color:var(--muted); }
    .badge{ font-size:11px; padding:6px 10px; border-radius:999px; border:1px solid var(--line); color:var(--muted); white-space:nowrap; }
    .badge.quote{ border-color: rgba(245,179,1,.4); color: var(--accent); }
    .badge.progress{ border-color: rgba(96,165,250,.35); color: #60a5fa; }
    .badge.done{ border-color: rgba(74,222,128,.35); color: var(--ok); }
    .badge.invoiced{ border-color: rgba(168,85,247,.35); color: #a855f7; }

    .tabs{ display:flex; gap:8px; flex-wrap:wrap; margin: 6px 0 12px; }
    .tab{ padding:10px 12px; border-radius:999px; border:1px solid var(--line); background:transparent; color:var(--muted); cursor:pointer; font-weight:700; font-size:12px; }
    .tab.active{ background: var(--line); color: var(--text); }

    .grid2{ display:grid; grid-template-columns: 1fr 1fr; gap:10px; }
    @media (max-width:720px){ .grid2{ grid-template-columns:1fr; } }

    table{ width:100%; border-collapse:collapse; }
    th, td{ text-align:left; font-size:12px; padding:10px 8px; border-bottom:1px solid var(--line); vertical-align:top; }
    th{ color:var(--muted); font-weight:700; }
    .right{ text-align:right; }
    .muted{ color:var(--muted); }
    .kpi{ display:flex; gap:10px; flex-wrap:wrap; margin-top:10px; }
    .kpi .pill b{ color:var(--text); }

    footer{
      position:fixed; bottom:0; left:0; right:0;
      background: rgba(0,0,0,.35);
      backdrop-filter: blur(10px);
      border-top:1px solid var(--line);
      padding:10px 16px;
    }
    .footerInner{ max-width:980px; margin:0 auto; display:flex; gap:10px; align-items:center; justify-content:space-between; flex-wrap:wrap; }
    .small{ font-size:12px; color:var(--muted); }
    .hidden{ display:none !important; }
  </style>
</head>
<body>
<header>
  <div class="brand">
    <div class="logo" aria-hidden="true"></div>
    <div>
      <h1>Rust Rebels</h1>
      <div class="sub">Quotes & Hours (local + Supabase sync, no GST)</div>
    </div>
  </div>
</header>

<main>
  <div class="row">
    <section class="card grow">
      <h2>Jobs</h2>
      <div class="toolbar">
        <input id="search" placeholder="Search client / job / notes…" />
        <select id="filterStatus" style="max-width:220px">
          <option value="">All statuses</option>
          <option value="QUOTE">Quote</option>
          <option value="IN_PROGRESS">In Progress</option>
          <option value="COMPLETED">Completed</option>
          <option value="INVOICED">Invoiced</option>
        </select>
        <button class="btn primary" id="newJobBtn">+ New Job</button>
      </div>

      <div class="kpi" id="kpis"></div>
      <div style="height:10px"></div>
      <div class="jobs" id="jobList"></div>
    </section>

    <section class="card side" id="settingsCard">
      <h2>Settings</h2>
      <label>Default hourly rate ($/hr)</label>
      <input id="defaultRate" type="number" step="0.01" />

      <label>Business details (shown on PDFs)</label>
      <input id="bizName" placeholder="Business name" />
      <input id="bizPhone" placeholder="Phone" />
      <input id="bizEmail" placeholder="Email" />
      <input id="bizAddress" placeholder="Address" />

      <div style="height:12px"></div>

      <div class="toolbar">
        <button class="btn" id="backupBtn">Export backup (JSON)</button>
        <label class="btn ghost" style="display:inline-flex; align-items:center; gap:8px; cursor:pointer;">
          Import backup
          <input id="importFile" type="file" accept="application/json" style="display:none" />
        </label>
        <button class="btn" id="syncBtn">Sync / Login</button>
        <button class="btn danger" id="wipeBtn">Clear all data</button>
      </div>

      <div class="small" style="margin-top:10px" id="syncStatus">
        Sync: <b class="muted">loading…</b>
      </div>

      <div class="small" style="margin-top:10px">
        Tip: For PDF export, open “Generate PDF” and use the iOS Share button to save/send the PDF.
      </div>
    </section>
  </div>

  <section class="card hidden" id="jobCard" style="margin-top:14px;">
    <div class="toolbar" style="justify-content:space-between; align-items:center;">
      <div>
        <h2 id="jobHeader" style="margin:0">Job</h2>
        <div class="sub" id="jobSub"></div>
      </div>
      <div class="toolbar">
        <button class="btn ghost" id="closeJobBtn">Close</button>
        <button class="btn danger" id="deleteJobBtn">Delete</button>
      </div>
    </div>

    <div class="tabs" style="margin-top:12px;">
      <button class="tab active" data-tab="details">Details</button>
      <button class="tab" data-tab="time">Hours</button>
      <button class="tab" data-tab="materials">Materials</button>
      <button class="tab" data-tab="pdf">PDF</button>
    </div>

    <div id="tab-details">
      <div class="grid2">
        <div>
          <label>Client name</label>
          <input id="jobClient" />
        </div>
        <div>
          <label>Status</label>
          <select id="jobStatus">
            <option value="QUOTE">Quote</option>
            <option value="IN_PROGRESS">In Progress</option>
            <option value="COMPLETED">Completed</option>
            <option value="INVOICED">Invoiced</option>
          </select>
        </div>
      </div>

      <label>Job title</label>
      <input id="jobTitle" />

      <label>Description</label>
      <textarea id="jobDesc"></textarea>

      <div class="grid2">
        <div>
          <label>Location (optional)</label>
          <input id="jobLocation" />
        </div>
        <div>
          <label>Hourly rate override ($/hr, optional)</label>
          <input id="jobRate" type="number" step="0.01" placeholder="Leave blank to use default" />
        </div>
      </div>

      <label>Notes</label>
      <textarea id="jobNotes"></textarea>

      <div style="height:12px"></div>
      <button class="btn primary" id="saveJobBtn">Save job</button>
    </div>

    <div id="tab-time" class="hidden">
      <h2 style="font-size:13px; margin:0 0 10px;">Add hours</h2>
      <div class="grid2">
        <div>
          <label>Date</label>
          <input id="tDate" type="date" />
        </div>
        <div>
          <label>Rate used ($/hr)</label>
          <input id="tRate" type="number" step="0.01" />
        </div>
      </div>
      <div class="grid2">
        <div>
          <label>Start time (optional)</label>
          <input id="tStart" type="time" />
        </div>
        <div>
          <label>End time (optional)</label>
          <input id="tEnd" type="time" />
        </div>
      </div>
      <div class="grid2">
        <div>
          <label>OR Duration (hours)</label>
          <input id="tDuration" type="number" step="0.01" placeholder="e.g. 2.5" />
        </div>
        <div>
          <label>Break minutes</label>
          <input id="tBreak" type="number" step="1" value="0" />
        </div>
      </div>
      <label>Work description</label>
      <input id="tDesc" placeholder="e.g. Fitment + welding" />
      <div style="height:10px"></div>
      <button class="btn primary" id="addTimeBtn">Add entry</button>

      <div style="height:16px"></div>
      <h2 style="font-size:13px; margin:0 0 8px;">Entries</h2>
      <div class="pill" id="timeTotals"></div>
      <div style="height:10px"></div>
      <div style="overflow:auto">
        <table id="timeTable">
          <thead>
            <tr>
              <th>Date</th>
              <th>Description</th>
              <th class="right">Hours</th>
              <th class="right">$</th>
              <th></th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </div>

    <div id="tab-materials" class="hidden">
      <h2 style="font-size:13px; margin:0 0 10px;">Add material/expense</h2>
      <div class="grid2">
        <div>
          <label>Item</label>
          <input id="mItem" placeholder="e.g. Steel plate 6mm" />
        </div>
        <div>
          <label>Quantity</label>
          <input id="mQty" type="number" step="0.01" value="1" />
        </div>
      </div>
      <div class="grid2">
        <div>
          <label>Unit cost ($)</label>
          <input id="mUnit" type="number" step="0.01" value="0" />
        </div>
        <div>
          <label>Sell price override (optional, $)</label>
          <input id="mSell" type="number" step="0.01" placeholder="Leave blank = qty * unit cost" />
        </div>
      </div>
      <label>Notes (optional)</label>
      <input id="mNote" placeholder="e.g. Supplier invoice #123" />
      <div style="height:10px"></div>
      <button class="btn primary" id="addMatBtn">Add item</button>

      <div style="height:16px"></div>
      <h2 style="font-size:13px; margin:0 0 8px;">Items</h2>
      <div class="pill" id="matTotals"></div>
      <div style="height:10px"></div>
      <div style="overflow:auto">
        <table id="matTable">
          <thead>
            <tr>
              <th>Item</th>
              <th class="right">Qty</th>
              <th class="right">$</th>
              <th></th>
